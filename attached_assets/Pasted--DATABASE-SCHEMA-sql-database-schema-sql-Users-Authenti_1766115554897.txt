 DATABASE SCHEMA
sql
-- database/schema.sql

-- Users & Authentication
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255),
  provider VARCHAR(50), -- 'google', 'linkedin', 'github', 'email'
  provider_id VARCHAR(255),
  is_guest BOOLEAN DEFAULT FALSE,
  guest_expires_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- User Profiles
CREATE TABLE user_profiles (
  user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,
  name VARCHAR(255),
  avatar_url TEXT,
  bio TEXT,
  skills TEXT[],
  experience_level VARCHAR(50),
  risk_tolerance INTEGER CHECK (risk_tolerance >= 1 AND risk_tolerance <= 10),
  available_capital DECIMAL(12,2),
  time_commitment INTEGER, -- hours per week
  subscription_tier VARCHAR(50) DEFAULT 'free',
  subscription_status VARCHAR(50) DEFAULT 'inactive',
  stripe_customer_id VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Opportunities
CREATE TABLE opportunities (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  problem_statement TEXT,
  market_size_min DECIMAL(12,2),
  market_size_max DECIMAL(12,2),
  growth_rate DECIMAL(5,2),
  validation_score INTEGER CHECK (validation_score >= 0 AND validation_score <= 100),
  age_days INTEGER,
  status VARCHAR(50) DEFAULT 'active', -- 'hot', 'fresh', 'validated', 'archive'
  access_tier_required VARCHAR(50) DEFAULT 'free',
  is_public_preview BOOLEAN DEFAULT TRUE,
  preview_content JSONB,
  full_content JSONB,
  unlock_price_cents INTEGER DEFAULT 0,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Services Marketplace
CREATE TABLE services (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  type VARCHAR(50), -- 'feasibility_study', 'market_research', 'financial_model', 'consultation'
  category VARCHAR(50),
  creator_id UUID REFERENCES users(id) ON DELETE CASCADE,
  price_cents INTEGER NOT NULL,
  commission_rate DECIMAL(5,2) DEFAULT 0.30, -- 30% platform commission
  ai_generated BOOLEAN DEFAULT FALSE,
  requires_expert_review BOOLEAN DEFAULT FALSE,
  expert_id UUID REFERENCES users(id),
  preview_content JSONB,
  full_content JSONB,
  sales_count INTEGER DEFAULT 0,
  average_rating DECIMAL(3,2),
  status VARCHAR(50) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Transactions
CREATE TABLE transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  type VARCHAR(50) NOT NULL, -- 'purchase', 'unlock', 'subscription', 'refund', 'payout'
  item_type VARCHAR(50), -- 'opportunity', 'service', 'subscription'
  item_id UUID,
  amount_cents INTEGER NOT NULL,
  currency VARCHAR(3) DEFAULT 'USD',
  status VARCHAR(50) DEFAULT 'pending', -- 'pending', 'completed', 'failed', 'refunded'
  stripe_payment_intent_id VARCHAR(255),
  stripe_transfer_id VARCHAR(255),
  metadata JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);

-- User Access & Unlocks
CREATE TABLE user_access (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  opportunity_id UUID REFERENCES opportunities(id),
  service_id UUID REFERENCES services(id),
  access_type VARCHAR(50), -- 'unlock', 'purchase', 'subscription'
  amount_paid_cents INTEGER,
  expires_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Subscriptions
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  stripe_subscription_id VARCHAR(255),
  tier VARCHAR(50) NOT NULL,
  status VARCHAR(50) DEFAULT 'active',
  current_period_start TIMESTAMP,
  current_period_end TIMESTAMP,
  cancel_at_period_end BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Network & Community
CREATE TABLE network_connections (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  connected_user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  connection_type VARCHAR(50), -- 'follow', 'connection', 'mentor'
  status VARCHAR(50) DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_opportunities_status ON opportunities(status);
CREATE INDEX idx_opportunities_access_tier ON opportunities(access_tier_required);
CREATE INDEX idx_user_access_user ON user_access(user_id);
CREATE INDEX idx_transactions_user ON transactions(user_id);
CREATE INDEX idx_services_creator ON services(creator_id);
CREATE INDEX idx_subscriptions_user ON subscriptions(user_id);